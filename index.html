<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>計算書（安全版）</title>

<style>
body {
  font-family: sans-serif;
  padding: 20px;
}
input, button {
  margin: 6px 0;
  width: 100%;
  max-width: 300px;
  font-size: 16px;
  padding: 6px;
}
button {
  cursor: pointer;
}
</style>
</head>

<body>

<h2>計算書（安全版）</h2>

S:  <input id="S" type="number" step="any"><br>
B:  <input id="B" type="number" step="any"><br>
O1: <input id="O1" type="number" step="any"><br>
O2: <input id="O2" type="number" step="any"><br>
<button onclick="calc()">計算して送信</button>

<p>
結果<br>
T1 = <span id="t1"></span><br>
T2 = <span id="t2"></span>
</p>

<h3>貸借対照表</h3>
<table border="1" cellpadding="6">
  <tr>
    <th>借方</th>
    <th>金額</th>
    <th>貸方</th>
    <th>金額</th>
  </tr>
  <tr>
    <td>流動資産</td>
    <td id="ca"></td>
    <td>流動負債</td>
    <td id="cl"></td>
  </tr>
  <tr>
    <td>固定資産</td>
    <td id="fa"></td>
    <td>資本金</td>
    <td id="capital"></td>
  </tr>
</table>

<script>
const GAS_URL = "https://script.google.com/macros/s/AKfycbxEUrAoygIK74H0x5j2geeM08YAAFmQaEy46qp3rwcQWs77Tzi1Oi7zPdkDNJp6moc-nA/exec";

function calc() {
  const S  = parseFloat(document.getElementById("S").value);
  const B  = parseFloat(document.getElementById("B").value);
  const O1 = parseFloat(document.getElementById("O1").value);
  const O2 = parseFloat(document.getElementById("O2").value);

  // ===== 基本計算 =====
  const T1 = ( (B - S) / O1 );
  const T2 = ( (B - S) / O2 );

  document.getElementById("t1").textContent = T1.toFixed(2);
  document.getElementById("t2").textContent = T2.toFixed(2);

  // ===== 貸借対照表計算 =====
  const currentAssets      = O1 * T2;
  const currentLiabilities = O1 * T1;
  const fixedAssets        = B - currentAssets;
  const capital            = B - currentLiabilities;

  document.getElementById("ca").textContent = currentAssets.toFixed(2);
  document.getElementById("cl").textContent = currentLiabilities.toFixed(2);
  document.getElementById("fa").textContent = fixedAssets.toFixed(2);
  document.getElementById("capital").textContent = capital.toFixed(2);

  // ===== JSONP送信 =====
  const callbackName = "cb_" + Date.now();
  window[callbackName] = function(res) {
    delete window[callbackName];
  };

  const script = document.createElement("script");
  script.src =
    GAS_URL +
    "?T1=" + encodeURIComponent(T1.toFixed(2)) +
    "&T2=" + encodeURIComponent(T2.toFixed(2)) +
    "&CA=" + encodeURIComponent(currentAssets.toFixed(2)) +
    "&CL=" + encodeURIComponent(currentLiabilities.toFixed(2)) +
    "&FA=" + encodeURIComponent(fixedAssets.toFixed(2)) +
    "&CAPITAL=" + encodeURIComponent(capital.toFixed(2)) +
    "&callback=" + callbackName;

  document.body.appendChild(script);
}
</script>

</body>
</html>
